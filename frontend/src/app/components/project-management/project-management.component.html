<div class="project-container">
  <h1 class="list-title">Project Management</h1>
  <!-- Toggle Add/Edit Button -->
  <button class="btn btn-success" (click)="toggleAddForm()" id="btn">
    {{ editingProjectId ? ' Editing Project' : (showForm ? 'Cancel' : 'New Project') }}
  </button>

  <!-- Show form only if showForm is true -->
  <form *ngIf="showForm" [formGroup]="projectForm" (ngSubmit)="editingProjectId ? updateProject() : addProjects()" class="project-form">
    <h2 class="form-title">{{ editingProjectId ? ' Edit Project' : 'Add New Project' }}</h2>

    <div class="form-group">
      <label>Project Name</label>
      <input formControlName="name" class="form-input" />
    </div>

<div class="form-group" *ngIf="editingProjectId">
  <label>Status</label>
  <select formControlName="status" class="form-input">
    <option value="not started">Not Started</option>
    <option value="in progress">In Progress</option>
    <option value="completed">Completed</option>
    <option value="on hold">On Hold</option>
  </select>
</div>
<div class="form-group">
  <label>Deadline</label>
<input type="date" formControlName="deadline" [min]="minDate" class="form-input" />
</div>
    <div class="form-group">
      <label>Description</label>
      <textarea formControlName="description" class="form-textarea"></textarea>
    </div>

    <div class="button-group">
      <button type="submit">
        {{ editingProjectId ? 'Update' : 'Create' }}
      </button>
      <button type="button" *ngIf="editingProjectId" (click)="onCancelEdit()">
        Cancel
      </button>
    </div>
  </form>

  <div class="view-toggle">
    <button class="btn btn-outline-primary" [class.active]="viewMode === 'table'" (click)="setViewMode('table')">
      <i class="fas fa-bars" id="btnn"></i>
    </button>
    <button class="btn btn-outline-primary" [class.active]="viewMode === 'card'" (click)="setViewMode('card')">
      <i class="fas fa-th-large" id="btnn"></i>
   </button>
  </div>

  <div *ngIf="viewMode === 'table'">
    <div class="filters" *ngIf="!showForm">
      <label>Project Name:
        <input type="text" [(ngModel)]="filter.name" (input)="applyFilters()" placeholder="Search by name" />
      </label>
        <label>Status:
          <select [(ngModel)]="filter.status" (change)="applyFilters()">
            <option value="">All</option>
            <option *ngFor="let status of Statuses" [value]="status">{{ status }}</option>
          </select>
        </label>
      <button (click)="clearFilters()">x</button>
    </div>
    <table class="project-list">
      <thead>
        <tr>
          <th>Project Name</th>
          <th>Status</th>
          <th>Deadline</th>
          <th>Description</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let project of projects | paginate: { itemsPerPage: 5, currentPage: currentPage} " class="table-row-hover">
        <td><h2>{{ project.name }}</h2></td>
          <td><span class="status-badge"
             [ngClass]="getStatusClass(project.status)">
             {{ project.status || 'Not Started' }}</span>
            </td>
          <td>{{ project.deadline ? (project.deadline | date:'MM/dd/yyyy') : 'N/A' }}</td>
          <td>{{ project.description }}</td>
          <td class="item-buttons">
            <button  (click)="onEdit(project)"><i class="fa-solid fa-pen-to-square"></i></button>
            <button  (click)="onDelete(project.id)"><i class="fa-solid fa-trash"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
    <ng-template #noProjects>
      <p class="alert alert-info">No projects found.</p>
    </ng-template>
    <pagination-controls (pageChange)="currentPage = $event"></pagination-controls>
  </div>

  <div *ngIf="viewMode === 'card'" class="card-grid">
    <div class="project-card" *ngFor="let project of projects">
      <h2>{{ project.name }}</h2>
      <p><strong>Status:</strong> <span class="status-badge" [ngClass]="getStatusClass(project.status)">{{ project.status || 'Not Started' }}</span></p>
      <p><strong>Deadline:</strong> {{ project.deadline ? (project.deadline | date:'MM/dd/yyyy') : 'N/A' }}</p>
      <p><strong>Description:</strong> {{ project.description }}</p>
      <div class="item-buttons">
        <button (click)="onEdit(project)"><i class="fa-solid fa-pen-to-square"></i></button>
        <button (click)="onDelete(project.id)"><i class="fa-solid fa-trash"></i></button>
      </div>
    </div>
  </div>
</div>
