<div class="employee-container">
  <h1 class="list-title">Employee Management</h1>
  <!-- Toggle Add/Edit Button -->
  <button class="btn btn-success" (click)="toggleAddForm()" id="btn">
    {{ editMode ? ' Editing Employee' : (showForm ? 'Cancel' : 'Add Employee') }}
  </button>
  <!-- Show form only if showForm is true -->
  <form *ngIf="showForm" [formGroup]="employeeForm" (ngSubmit)=" selectedEmployeeId ? updateEmployee() : createEmployee()" class="employee-form">
    <h2 class="form-title">{{ editMode ? ' Edit Employee' : 'Add New Employee' }}</h2>

    <div class="form-group">
      <label for="name">Name</label>
      <input formControlName="name" class="form-input" id="name" />
      <div *ngIf="formControls['name'].invalid && (formControls['name'].dirty || formControls['name'].touched)" class="text-danger">
        <small *ngIf="formControls['name'].errors?.['required']">Name is required</small>
      </div>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input formControlName="email" type="email" class="form-input" id="email" />
      <div *ngIf="formControls['email'].invalid && (formControls['email'].dirty || formControls['email'].touched)" class="text-danger">
        <small *ngIf="formControls['email'].errors?.['required']">Email is required</small>
        <small *ngIf="formControls['email'].errors?.['email']">Please enter a valid email</small>
      </div>
    </div>

    <div class="form-group">
      <label for="position">Position</label>
      <input formControlName="position" class="form-input" id="position" />
      <div *ngIf="formControls['position'].invalid && (formControls['position'].dirty || formControls['position'].touched)" class="text-danger">
        <small *ngIf="formControls['position'].errors?.['required']">Position is required</small>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Job Type</label>
      <select formControlName="job_type" class="form-control">
        <option *ngFor="let job_type of job_types" [value]="job_type">{{ job_type }}</option>
      </select>
    </div>

    <div class="form-group" *ngIf="authService.isAdmin()">
      <label class="form-label">Role</label>
      <select formControlName="role" class="form-control">
        <option *ngFor="let role of userRoles" [value]="role">{{ role }}</option>
      </select>
      <div *ngIf="formControls['role'].invalid && (formControls['role'].dirty || formControls['role'].touched)" class="text-danger">
        <small *ngIf="formControls['role'].errors?.['required']">Role is required</small>
      </div>
    </div>

    <div class="button-group">
      <button type="submit" [disabled]="employeeForm.invalid">
        {{ editMode ? 'Update' : 'Create' }}
      </button>
      <button type="button" *ngIf="editMode" (click)="onCancel()">
        Cancel
      </button>
    </div>
  </form>

  <div class="employee-list">
    <div class="filters" *ngIf="!showForm">
  <label>
    Name:
    <input type="text" [(ngModel)]="filter.name" (input)="applyFilters()" placeholder="Search by name">
  </label>
  <label>
    Position:
    <input type="text" [(ngModel)]="filter.position" (input)="applyFilters()" placeholder="Search by position">
  </label>
  <button (click)="clearFilters()">x</button>
</div>

    <table class="employee-list">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Position</th>
          <th>Job type</th>
          <th>Role</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
       <tr *ngFor="let employee of filteredEmployees | paginate: { itemsPerPage: 5, currentPage: currentPage }">
          <td>{{ employee.name }}</td>
          <td>{{ employee.email }}</td>
          <td>{{ employee.position }}</td>
          <td>{{ employee.job_type }}</td>
          <td>{{ employee.role }}</td>
          <td>
            <span class="status" [class.status_pending]="employee.status === 'pending'" [class.status_active]="employee.status === 'active'" [class.badge-warning]="employee.status === 'pending'" [class.badge-success]="employee.status === 'active'">
              {{ employee.status }}
            </span>
          </td>
          <td class="item-buttons">
            <button (click)="onEdit(employee)" title="Edit Employee"><i class="fa-solid fa-pen-to-square"></i></button>
            <button *ngIf="employee.status === 'pending'" (click)="resendInvite(employee)" title="Resend Invite">
              <i class="fa-solid fa-paper-plane"></i>
            </button>
            <button *ngIf="employee.status === 'pending' && employee.invite_token" (click)="showInviteLink(employee.invite_token!, employee.name, employee.email)" title="View Invite Link">
              <i class="fa-solid fa-link"></i>
            </button>
            <button *ngIf="employee.id" (click)="onDelete(employee.id)" title="Delete Employee"><i class="fa-solid fa-trash"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
    <ng-template #noEmployees>
      <p class="alert alert-info">No employees found.</p>
    </ng-template>
    <pagination-controls (pageChange)="currentPage = $event"></pagination-controls>
</div>
</div>
