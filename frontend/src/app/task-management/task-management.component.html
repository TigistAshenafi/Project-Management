<div class="task-management">
  <h2>Task Management</h2>

  <button class="btn btn-success" (click)="toggleForm()">
    {{ editingTaskId ? 'Update Task' : 'Add Task' }}
  </button>

  <form *ngIf="showForm" [formGroup]="taskForm" (ngSubmit)="editingTaskId ? updateTask() : addTasks()" class="task-form">
    <div>
      <label>Title</label>
      <input formControlName="title" type="text" required />
    </div>

    <div>
      <label>Description</label>
      <textarea formControlName="description"></textarea>
    </div>

    <div>
      <label>Status</label>
      <select formControlName="status">
        <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
      </select>
    </div>

    <div>
      <label>Project</label>
      <select formControlName="project_id">
        <option value="" disabled>Select Project</option>
        <option *ngFor="let project of projects" [value]="project.id">{{ project.name }}</option>
      </select>
    </div>

    <div>
      <label>Assigned to</label>
      <select formControlName="assigned_to">
        <option value="" disabled>Select Employee</option>
        <option *ngFor="let emp of employees" [value]="emp.id">{{ emp.name }}</option>
      </select>
    </div>

    <div>
      <label>Due Date</label>
      <input formControlName="due_date" type="date" required />
    </div>

    <button class="btn btn-primary" type="submit">{{ editingTaskId ? 'Update Task' : 'Add Task' }} </button>
    <button class="btn btn-secondary" type="button" *ngIf="editingTaskId" (click)="toggleForm()"> Clear </button>
  </form>

  <div class="task-list">
  <h3 class="list-title">Task List</h3>
  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Status</th>
        <th>Project</th>
        <th>Employee</th>
        <th>Due-Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let task of tasks | paginate: { itemsPerPage: 5, currentPage: currentPage}">
        <td>{{ task.title }}</td>
        <td>{{ task.description }}</td>
        <td>{{ task.status }}</td>
        <td>{{ getProjectName(task.project_id) }}</td>
        <td>{{ getEmployeeName(task.assigned_to) }}</td>
        <td>{{ task.due_date | date: 'shortDate' }}</td>
        <td class="item-buttons">
          <button class="btn btn-warning" (click)="onEdit(task)">Edit</button>
          <button class="btn btn-danger" *ngIf="task.id" (click)="onDelete(task.id)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
  <pagination-controls (pageChange)="currentPage = $event"></pagination-controls>
</div>
</div>
